name: ğŸª„ Create Branch on Issue

on:
  issues:
    types: [ opened ]

jobs:
  create-branch:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          ref: dev

      - name: Create branch for new issue
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          echo "â–¶ï¸ ì´ìŠˆ ê¸°ë°˜ ë¸Œëœì¹˜ ìë™ ìƒì„± ì‹œì‘"

          ISSUE_TITLE="${{ github.event.issue.title }}"
          ISSUE_NUMBER="${{ github.event.issue.number }}"
          ISSUE_BODY="${{ github.event.issue.body }}"

          echo "ğŸ§¾ ì´ìŠˆ ì œëª©: $ISSUE_TITLE"
          echo "ğŸ§¾ ì´ìŠˆ ë²ˆí˜¸: $ISSUE_NUMBER"
          echo "ğŸ§¾ ì´ìŠˆ ë³¸ë¬¸: $ISSUE_BODY"

          # ë¹ˆ ì¤„ ë¬´ì‹œí•˜ê³  ë„ë©”ì¸ ì¶”ì¶œ (ğŸ—‚ ë„ë©”ì¸ ë‹¤ìŒ ì¤„ ì¤‘ ì‹¤ì œ ê°’)
          DOMAIN=$(echo "$ISSUE_BODY" | tr -d '\r' | awk '/ğŸ—‚ ë„ë©”ì¸/{found=1; next} found && NF {print; exit}' | grep -o '([^)]+)' | tr -d '()' | tr '[:upper:]' '[:lower:]')
          echo "ğŸ” DOMAIN ì¶”ì¶œ ê²°ê³¼: $DOMAIN"

          if [ -z "$DOMAIN" ]; then
            echo "âŒ ë„ë©”ì¸ ê°’ì„ ì¶”ì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¸Œëœì¹˜ë¥¼ ìƒì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
            exit 1
          fi

          # ë¸Œëœì¹˜ ì´ë¦„ ìƒì„± (ê³µë°±, íŠ¹ìˆ˜ë¬¸ì ì œê±°)
          SANITIZED_DOMAIN=$(echo "$DOMAIN" | tr -cd '[:alnum:]-')
          BRANCH_NAME="feature/${SANITIZED_DOMAIN}-${ISSUE_NUMBER}"
          echo "ğŸ“Œ ë¸Œëœì¹˜ ì´ë¦„: $BRANCH_NAME"

          git config --global user.email "action@github.com"
          git config --global user.name "GitHub Action"

          echo "ğŸ“¥ ì €ì¥ì†Œ í´ë¡  ì¤‘..."
          git clone https://x-access-token:${GH_TOKEN}@github.com/${{ github.repository }} repo

          cd repo
          git checkout -b "$BRANCH_NAME"

          echo "ğŸš€ ë¸Œëœì¹˜ í‘¸ì‹œ ì‹œì‘..."
          git push origin "$BRANCH_NAME"

          echo "âœ… ë¸Œëœì¹˜ ìƒì„± ì™„ë£Œ: $BRANCH_NAME"
